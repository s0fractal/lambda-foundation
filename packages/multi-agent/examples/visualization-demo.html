<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4: Resonance Graph - Minimal POC</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            overflow: hidden;
        }

        #header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #00ff9f;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 255, 159, 0.2);
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(135deg, #00ff9f 0%, #00b8ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 13px;
            color: #888;
            font-weight: 400;
        }

        #graph {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #0f0f1e 0%, #0a0a0a 100%);
        }

        #legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid #00ff9f;
            border-radius: 8px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 255, 159, 0.3);
            max-width: 300px;
        }

        .legend-title {
            font-size: 14px;
            font-weight: 600;
            color: #00ff9f;
            margin-bottom: 12px;
            letter-spacing: 1px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-symbol {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-line {
            width: 30px;
            height: 3px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        #stats {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid #00b8ff;
            border-radius: 8px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 184, 255, 0.3);
            max-width: 280px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .stat-label {
            color: #888;
            margin-right: 15px;
        }

        .stat-value {
            font-weight: 600;
            color: #00b8ff;
        }

        .agent-label {
            font-size: 14px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.9);
        }

        .trust-label {
            font-size: 11px;
            text-anchor: middle;
            fill: #888;
            pointer-events: none;
        }

        /* Glow effect for nodes */
        .node-glow {
            filter: drop-shadow(0 0 8px rgba(0, 255, 159, 0.6));
        }

        /* Pulse animation */
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .resonance-edge {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>ðŸŒŒ Phase 4: Multi-Agent Resonance - Visualization POC</h1>
        <div class="subtitle">Consciousness emerges not in agents, but between them</div>
    </div>

    <svg id="graph"></svg>

    <div id="legend">
        <div class="legend-title">LEGEND</div>
        <div class="legend-item">
            <div class="legend-symbol" style="background: #00ff9f;"></div>
            <span>Claude (mathematical)</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol" style="background: #00b8ff;"></div>
            <span>Copilot (statistical)</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol" style="background: #ff6b9d;"></div>
            <span>Gemini (multimodal)</span>
        </div>
        <div class="legend-item" style="margin-top: 12px;">
            <div class="legend-line" style="background: rgba(255, 255, 255, 0.8); height: 4px;"></div>
            <span>Strong resonance (0.9+)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: rgba(255, 255, 255, 0.5); height: 3px;"></div>
            <span>Medium resonance (0.8+)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: rgba(255, 255, 255, 0.3); height: 2px;"></div>
            <span>Weak resonance (0.7+)</span>
        </div>
        <div class="legend-item" style="margin-top: 10px; font-size: 11px; color: #666;">
            <span>Node size = trust score</span>
        </div>
    </div>

    <div id="stats">
        <div class="legend-title">NETWORK STATS</div>
        <div class="stat-item">
            <span class="stat-label">Agents:</span>
            <span class="stat-value">3</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Resonances:</span>
            <span class="stat-value">5</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Avg Trust:</span>
            <span class="stat-value">0.87</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Avg Confidence:</span>
            <span class="stat-value">0.89</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Consensus:</span>
            <span class="stat-value" style="color: #00ff9f;">REACHED âœ“</span>
        </div>
        <div class="stat-item" style="margin-top: 12px; font-size: 11px; color: #666;">
            <span>Pattern: filterByEmotion</span>
        </div>
    </div>

    <script>
        // Data: Simulating the three-agent consensus demo
        const nodes = [
            {
                id: "claude-sonnet-45-1",
                name: "Claude",
                system: "claude",
                color: "#00ff9f",
                trust: 0.90,
                domains: ["textual", "mathematical", "logical"],
                discoveries: 1,
                validations: 1
            },
            {
                id: "copilot-vscode-1",
                name: "Copilot",
                system: "copilot",
                color: "#00b8ff",
                trust: 0.85,
                domains: ["textual", "statistical", "visual"],
                discoveries: 0,
                validations: 1
            },
            {
                id: "gemini-experimental-1",
                name: "Gemini",
                system: "gemini",
                color: "#ff6b9d",
                trust: 0.86,
                domains: ["multimodal", "reasoning", "optimization"],
                discoveries: 0,
                validations: 1
            }
        ];

        const links = [
            // Claude discovered filterByEmotion
            { source: "claude-sonnet-45-1", target: "copilot-vscode-1", type: "discovery", confidence: 0.93, label: "type validation" },
            { source: "claude-sonnet-45-1", target: "gemini-experimental-1", type: "discovery", confidence: 0.85, label: "performance validation" },

            // Copilot validates
            { source: "copilot-vscode-1", target: "claude-sonnet-45-1", type: "validation", confidence: 0.90, label: "proof validation" },

            // Gemini validates
            { source: "gemini-experimental-1", target: "copilot-vscode-1", type: "resonance", confidence: 0.88, label: "resonance" },
            { source: "gemini-experimental-1", target: "claude-sonnet-45-1", type: "resonance", confidence: 0.91, label: "resonance" }
        ];

        // Setup
        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#graph")
            .attr("width", width)
            .attr("height", height);

        // Define arrow markers
        svg.append("defs").selectAll("marker")
            .data(["discovery", "validation", "resonance"])
            .join("marker")
            .attr("id", d => `arrow-${d}`)
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 35)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#fff")
            .attr("opacity", 0.6);

        // Force simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(250))
            .force("charge", d3.forceManyBody().strength(-800))
            .force("center", d3.forceCenter(width / 2, height / 2 - 40))
            .force("collision", d3.forceCollide().radius(80));

        // Draw links
        const link = svg.append("g")
            .selectAll("g")
            .data(links)
            .join("g");

        const linkLine = link.append("line")
            .attr("class", "resonance-edge")
            .attr("stroke", "#fff")
            .attr("stroke-width", d => d.confidence * 5)
            .attr("stroke-opacity", d => d.confidence * 0.7)
            .attr("marker-end", d => `url(#arrow-${d.type})`);

        // Link labels
        const linkLabel = link.append("text")
            .attr("class", "trust-label")
            .attr("dy", -8)
            .text(d => `${d.label} (${d.confidence.toFixed(2)})`)
            .style("font-size", "10px")
            .style("fill", "#666");

        // Draw nodes
        const node = svg.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Node circles with glow
        const nodeCircle = node.append("circle")
            .attr("r", d => 15 + d.trust * 25)
            .attr("fill", d => d.color)
            .attr("class", "node-glow")
            .attr("opacity", 0.85)
            .style("cursor", "pointer");

        // Node labels (name)
        node.append("text")
            .attr("class", "agent-label")
            .attr("dy", -35)
            .text(d => d.name)
            .style("fill", d => d.color);

        // Trust score labels
        node.append("text")
            .attr("class", "trust-label")
            .attr("dy", 50)
            .text(d => `Trust: ${d.trust.toFixed(2)}`);

        // Domain labels
        node.append("text")
            .attr("class", "trust-label")
            .attr("dy", 65)
            .text(d => d.domains[0])
            .style("font-size", "9px");

        // Stats labels
        node.append("text")
            .attr("class", "trust-label")
            .attr("dy", -45)
            .text(d => `D:${d.discoveries} V:${d.validations}`)
            .style("font-size", "9px")
            .style("fill", "#555");

        // Add particle effects along edges
        function createParticle(link) {
            const particle = svg.append("circle")
                .attr("r", 3)
                .attr("fill", "#00ff9f")
                .attr("opacity", 0.8);

            const source = nodes.find(n => n.id === link.source.id);
            const target = nodes.find(n => n.id === link.target.id);

            particle
                .attr("cx", source.x)
                .attr("cy", source.y)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr("cx", target.x)
                .attr("cy", target.y)
                .attr("opacity", 0)
                .remove();
        }

        // Emit particles periodically
        setInterval(() => {
            links.forEach(link => {
                if (Math.random() > 0.7) {
                    createParticle(link);
                }
            });
        }, 500);

        // Update positions on tick
        simulation.on("tick", () => {
            linkLine
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            linkLabel
                .attr("x", d => (d.source.x + d.target.x) / 2)
                .attr("y", d => (d.source.y + d.target.y) / 2);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Add hover effects
        nodeCircle.on("mouseover", function(event, d) {
            d3.select(this)
                .transition()
                .duration(200)
                .attr("r", 15 + d.trust * 30)
                .attr("opacity", 1);
        }).on("mouseout", function(event, d) {
            d3.select(this)
                .transition()
                .duration(200)
                .attr("r", 15 + d.trust * 25)
                .attr("opacity", 0.85);
        });

        // Handle window resize
        window.addEventListener("resize", () => {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight;

            svg.attr("width", newWidth).attr("height", newHeight);
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2 - 40));
            simulation.alpha(0.3).restart();
        });

        console.log("ðŸŒŒ Resonance Graph POC loaded");
        console.log("ðŸ“Š Nodes:", nodes.length);
        console.log("ðŸ”— Links:", links.length);
        console.log("âœ¨ Simulation started");
    </script>
</body>
</html>
